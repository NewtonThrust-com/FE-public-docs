{
  "openapi": "3.0.0",
  "info": {
    "title": "FastAPI",
    "version": "0.1.0",
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "http://157.180.75.191:8000",
      "description": "Dev"
    }
  ],
  "paths": {
    "/login": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Login Step1",
        "operationId": "login_step1_login_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginIn"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/TokenResponse"
          },
          "401": {
            "description": "Credenziali errate",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Username o password errata"
                }
              }
            }
          },
          "423": {
            "description": "Password change required",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Password change required"
                }
              }
            }
          },
          "500": {
            "description": "Errore interno del server",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Errore interno del server"
                }
              }
            }
          }
        }
      }
    },
    "/login/verify": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Login Step2 Verify",
        "operationId": "login_step2_verify_login_verify_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginOtpVerifyIn"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TokenResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/signup": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Signup",
        "description": "Registrazione per Persone Fisiche o Aziende (Business)",
        "operationId": "signup",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  {
                    "$ref": "#/components/schemas/PersonSignupIn"
                  },
                  {
                    "$ref": "#/components/schemas/BusinessSignupIn"
                  },
                  {
                    "$ref": "#/components/schemas/UserSignupIn"
                  }
                ]
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserOutSchema"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/change-password": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Change user password",
        "description": "Allows a user to change password by providing the current password.",
        "operationId": "changePassword",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string",
                    "example": "user@example.com"
                  },
                  "currentPassword": {
                    "type": "string",
                    "example": "OldPassword123!"
                  },
                  "newPassword": {
                    "type": "string",
                    "example": "NewPassword456!"
                  }
                },
                "required": [
                  "username",
                  "currentPassword",
                  "newPassword"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/TokenResponse"
          },
          "401": {
            "description": "Invalid credentials",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "detail": {
                      "type": "string",
                      "example": "Username o password errata"
                    }
                  }
                }
              }
            }
          },
          "423": {
            "description": "Password change required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "detail": {
                      "type": "string",
                      "example": "Password change required"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/vehicles": {
      "get": {
        "tags": [
          "vehicles"
        ],
        "summary": "List Vehicles",
        "operationId": "list_vehicles_vehicles_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/VehicleSchema"
                  },
                  "type": "array",
                  "title": "Response List Vehicles Vehicles Get",
                  "example": [
                    {
                      "id": "1",
                      "brand": "Pagani",
                      "model": "Utopia",
                      "b2c_price": 500000,
                      "fuel_type": "Petrol",
                      "transmission": "Automatic",
                      "type": "Sportiva",
                      "category": "Categoria A",
                      "registration_date": "2019-12-15",
                      "mileage": 10000
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/vehicles/{vehicle_id}/images": {
      "get": {
        "tags": [
          "vehicles"
        ],
        "summary": "List Vehicle Images",
        "operationId": "list_vehicle_images_vehicles__vehicle_id__images_get",
        "parameters": [
          {
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Vehicle Id"
            },
            "name": "vehicle_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/VehicleImageOut"
                  },
                  "type": "array",
                  "title": "Response List Vehicle Images Vehicles  Vehicle Id  Images Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/orders/create": {
      "post": {
        "tags": [
          "orders"
        ],
        "summary": "Create a new order",
        "description": "Creates a new order including tickets, email, extras, and vehicle information.",
        "operationId": "createOrder",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "tickets": {
                    "type": "object",
                    "properties": {
                      "quantity": {
                        "type": "integer",
                        "example": 1
                      },
                      "amount": {
                        "type": "number",
                        "format": "float",
                        "example": 99.9
                      },
                      "id": {
                        "type": "string",
                        "example": "123"
                      }
                    },
                    "required": [
                      "quantity",
                      "amount",
                      "id"
                    ]
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "200@Mail.com"
                  },
                  "extras": {
                    "type": "object",
                    "description": "Se c'Ã¨ il full kit li mandiamo tutti",
                    "properties": {
                      "ids": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "example": [
                          "1",
                          "4",
                          "7"
                        ]
                      },
                      "amount": {
                        "type": "number",
                        "format": "float",
                        "example": 150
                      }
                    },
                    "required": [
                      "ids",
                      "amount"
                    ]
                  },
                  "vehicle": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "example": "1"
                      }
                    },
                    "required": [
                      "id"
                    ]
                  }
                },
                "required": [
                  "tickets",
                  "email",
                  "extras",
                  "vehicle"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Order created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "order_id"
                  ],
                  "properties": {
                    "order_id": {
                      "$ref": "#/components/schemas/order_id"
                    },
                    "status": {
                      "type": "string",
                      "example": "confirmed"
                    },
                    "total_amount": {
                      "type": "number",
                      "example": 249.9
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/payments/create-checkout-session": {
      "post": {
        "tags": [
          "payments"
        ],
        "summary": "Create Stripe checkout session",
        "operationId": "createCheckoutSession",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "order_id"
                ],
                "properties": {
                  "order_id": {
                    "$ref": "#/components/schemas/order_id"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Checkout session created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "clientSecret",
                    "returnUrl"
                  ],
                  "properties": {
                    "clientSecret": {
                      "type": "string",
                      "example": "xyz"
                    },
                    "returnUrl": {
                      "type": "string",
                      "example": "https://yourdomain.com/payment/return?session_id=cs_test_a1b2c3d4"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/payments/session-status": {
      "get": {
        "tags": [
          "payments"
        ],
        "summary": "Get payment session status",
        "operationId": "getPaymentsSessionStatus",
        "parameters": [
          {
            "name": "session_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Stripe Checkout session ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Session status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "status",
                    "customer_email"
                  ],
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "complete",
                      "description": "Payment status: 'open' or 'complete'",
                      "enum": [
                        "open",
                        "complete"
                      ]
                    },
                    "customer_email": {
                      "type": "string",
                      "example": "customer@example.com"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/tickets": {
      "get": {
        "tags": [
          "tickets"
        ],
        "summary": "List Tickets",
        "operationId": "list_tickets_tickets_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Ticket"
                  },
                  "title": "Response List Tickets Tickets Get"
                },
                "examples": {
                  "success": {
                    "summary": "Example ticket list",
                    "value": [
                      {
                        "label": "Gold",
                        "price": 129.99
                      },
                      {
                        "label": "Silver",
                        "price": 99.99
                      },
                      {
                        "label": "Bronze",
                        "price": 79.99
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "/extras": {
      "get": {
        "tags": [
          "campaign"
        ],
        "summary": "List Extras",
        "operationId": "list_extras_extras_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Extras"
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "responses": {
      "TokenResponse": {
        "description": "Successful login or password-change response",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/TokenResponse"
            }
          }
        }
      }
    },
    "schemas": {
      "Extras": {
        "title": "Extras",
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "1"
          },
          "label": {
            "type": "string",
            "example": "Pacchetto Lusso"
          },
          "ticket_type_id": {
            "type": "string",
            "example": "Gold"
          },
          "price": {
            "type": "number",
            "format": "float",
            "example": 199.99
          },
          "excludeOthers": {
            "type": "boolean",
            "example": false
          }
        },
        "required": [
          "id",
          "label",
          "ticket_type_id",
          "price",
          "excludeOthers"
        ]
      },
      "FuelType": {
        "type": "string",
        "enum": [
          "Petrol",
          "Diesel",
          "LPG",
          "CNG",
          "Ethanol",
          "Biodiesel",
          "Electric",
          "PHEV",
          "HEV"
        ],
        "title": "FuelType",
        "description": "An enumeration."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "LoginIn": {
        "properties": {
          "username": {
            "type": "string",
            "title": "Username"
          },
          "password": {
            "type": "string",
            "title": "Password"
          }
        },
        "type": "object",
        "required": [
          "username",
          "password"
        ],
        "title": "LoginIn"
      },
      "LoginOtpVerifyIn": {
        "properties": {
          "username": {
            "type": "string",
            "title": "Username"
          },
          "otp": {
            "type": "string",
            "title": "Otp"
          }
        },
        "type": "object",
        "required": [
          "username",
          "otp"
        ],
        "title": "LoginOtpVerifyIn"
      },
      "PhotoType": {
        "type": "string",
        "enum": [
          "Exterior",
          "Interior",
          "Engine",
          "Dashboard",
          "Trunk",
          "Wheels",
          "Other"
        ],
        "title": "PhotoType",
        "description": "An enumeration."
      },
      "order_id": {
        "type": "string",
        "example": "ORD-98765"
      },
      "RequesterType": {
        "type": "string",
        "enum": [
          "OurCompany",
          "OtherCompany",
          "Private"
        ],
        "title": "RequesterType",
        "description": "An enumeration."
      },
      "TokenResponse": {
        "properties": {
          "access_token": {
            "type": "string",
            "title": "Access Token"
          },
          "token_type": {
            "type": "string",
            "title": "Token Type",
            "default": "bearer"
          }
        },
        "type": "object",
        "required": [
          "access_token"
        ],
        "title": "TokenResponse"
      },
      "TransmissionType": {
        "type": "string",
        "enum": [
          "Manual",
          "Automatic",
          "SemiAutomatic",
          "Cvt",
          "DualClutch",
          "ShiftByWire",
          "Amt",
          "Electric",
          "Etc",
          "FrictionPlate"
        ],
        "title": "TransmissionType",
        "description": "An enumeration."
      },
      "UserSignupIn": {
        "properties": {
          "username": {
            "type": "string",
            "title": "Username"
          },
          "password": {
            "type": "string",
            "title": "Password"
          },
          "email": {
            "type": "string",
            "title": "Email"
          }
        },
        "type": "object",
        "required": [
          "username",
          "password",
          "email"
        ],
        "title": "UserSignupIn"
      },
      "UserOutSchema": {
        "properties": {
          "message": {
            "type": "string",
            "example": "User created successfully"
          }
        },
        "type": "object",
        "title": "UserOutSchema"
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      },
      "VatRegimeType": {
        "type": "string",
        "enum": [
          "VatExposed",
          "VatMargin",
          "Exempt"
        ],
        "title": "VatRegimeType",
        "description": "An enumeration."
      },
      "VehicleImageOut": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "url": {
            "type": "string",
            "title": "Url"
          },
          "photo_type": {
            "$ref": "#/components/schemas/PhotoType"
          },
          "sort_order": {
            "type": "integer",
            "title": "Sort Order"
          }
        },
        "type": "object",
        "required": [
          "id",
          "url",
          "photo_type",
          "sort_order"
        ],
        "title": "VehicleImageOut"
      },
      "VehicleSchema": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "category": {
            "type": "string",
            "title": "Category Filter"
          },
          "type": {
            "type": "string",
            "title": "Type Filter"
          },
          "brand": {
            "type": "string",
            "title": "Brand"
          },
          "model": {
            "type": "string",
            "title": "Model"
          },
          "registration_date": {
            "type": "string",
            "format": "date",
            "title": "Registration Date"
          },
          "mileage": {
            "type": "integer",
            "title": "Mileage"
          },
          "color": {
            "type": "string",
            "title": "Color"
          },
          "power": {
            "type": "integer",
            "title": "Power"
          },
          "dealer_id": {
            "type": "string",
            "title": "Dealer Id"
          },
          "fuel_type": {
            "$ref": "#/components/schemas/FuelType"
          },
          "transmission": {
            "$ref": "#/components/schemas/TransmissionType"
          },
          "requester": {
            "$ref": "#/components/schemas/RequesterType"
          },
          "vat_regime": {
            "$ref": "#/components/schemas/VatRegimeType"
          },
          "b2c_margin_range_min": {
            "type": "number",
            "title": "B2C Margin Range Min"
          },
          "b2c_margin_range_max": {
            "type": "number",
            "title": "B2C Margin Range Max"
          },
          "b2b_price": {
            "type": "number",
            "title": "B2B Price"
          },
          "b2c_price": {
            "type": "number",
            "title": "B2C Price"
          }
        },
        "type": "object",
        "required": [
          "b2c_price",
          "brand",
          "category",
          "fuel_type",
          "id",
          "mileage",
          "model",
          "registration_date",
          "transmission",
          "type"
        ],
        "title": "VehicleSchema"
      },
      "Ticket": {
        "type": "object",
        "title": "Ticket",
        "required": [
          "id",
          "label",
          "price"
        ],
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "example": "123"
          },
          "label": {
            "type": "string",
            "title": "Label",
            "example": "Gold"
          },
          "price": {
            "type": "number",
            "format": "float",
            "title": "Price",
            "minimum": 0,
            "example": 129.99
          }
        }
      },
      "PersonSignupIn": {
        "type": "object",
        "required": [
          "type",
          "fullName",
          "email",
          "phoneNumber",
          "fiscalCode",
          "idDocumentNumber",
          "birthDate",
          "birthCity",
          "birthCountry",
          "address"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "person"
            ],
            "default": "person"
          },
          "fullName": {
            "type": "string",
            "example": "Mario Rossi"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "phoneNumber": {
            "type": "string"
          },
          "fiscalCode": {
            "type": "string"
          },
          "birthDate": {
            "type": "string",
            "format": "date"
          },
          "birthCity": {
            "type": "string"
          },
          "birthCountry": {
            "type": "string"
          },
          "address": {
            "type": "string"
          }
        }
      },
      "BusinessSignupIn": {
        "type": "object",
        "required": [
          "type",
          "businessName",
          "registeredOffice",
          "vatNumber",
          "legalRepresentativeName",
          "legalRepresentativeId",
          "email",
          "businessPhone"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "business"
            ],
            "default": "business"
          },
          "businessName": {
            "type": "string",
            "example": "Tech S.r.l."
          },
          "vatNumber": {
            "type": "string"
          },
          "registeredOffice": {
            "type": "string"
          },
          "legalRepresentativeName": {
            "type": "string"
          },
          "legalRepresentativeId": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "businessPhone": {
            "type": "string"
          }
        }
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  }
}
